<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Image Generator</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 900px;
        width: 100%;
        padding: 40px;
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 10px;
        font-size: 2.5em;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 40px;
        font-size: 1.1em;
      }

      .upload-section {
        margin-bottom: 30px;
      }

      .upload-area {
        border: 3px dashed #667eea;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #f8f9ff;
      }

      .upload-area:hover {
        background: #f0f2ff;
        border-color: #764ba2;
      }

      .upload-area.drag-over {
        background: #e8ebff;
        border-color: #764ba2;
      }

      .upload-icon {
        font-size: 3em;
        margin-bottom: 15px;
      }

      .upload-text {
        color: #666;
        font-size: 1.1em;
      }

      #imageInput {
        display: none;
      }

      .preview-image {
        max-width: 100%;
        max-height: 300px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
      }

      .prompt-section {
        margin-bottom: 30px;
      }

      label {
        display: block;
        color: #333;
        font-weight: 600;
        margin-bottom: 10px;
        font-size: 1.1em;
      }

      textarea {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 1em;
        font-family: inherit;
        resize: vertical;
        min-height: 100px;
        transition: border-color 0.3s ease;
      }

      textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .button-group {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
      }

      button {
        flex: 1;
        padding: 15px 30px;
        font-size: 1.1em;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .generate-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .generate-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
      }

      .generate-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .regenerate-btn {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        display: none;
      }

      .regenerate-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(245, 87, 108, 0.4);
      }

      .download-btn {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        display: none;
      }

      .download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(79, 172, 254, 0.4);
      }

      .result-section {
        display: none;
        text-align: center;
      }

      .result-image {
        max-width: 100%;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 40px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: #667eea;
        font-size: 1.2em;
        font-weight: 600;
      }

      .error-message {
        display: none;
        background: #fee;
        color: #c33;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid #c33;
      }

      .info-box {
        background: #f8f9ff;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
        color: #555;
        font-size: 0.95em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>AI Image Generator</h1>
      <p class="subtitle">
        Upload an image and describe what you want to create
      </p>

      <div class="info-box">
        <strong>Important Note:</strong> Your API key is for OpenRouter (text
        models). For image generation, you'll need one of these:<br />
        ‚Ä¢ <strong>Option 1:</strong> Get a free API key from
        <a
          href="https://api.together.xyz/"
          target="_blank"
          style="color: #667eea"
          >Together AI</a
        ><br />
        ‚Ä¢ <strong>Option 2:</strong> Use Pollinations AI (selected by default -
        works without API key!)<br />
        ‚Ä¢ <strong>Option 3:</strong> Get OpenAI API key for DALL-E
      </div>

      <div class="error-message" id="errorMessage"></div>

      <div class="upload-section">
        <label>Upload Reference Image (Optional)</label>
        <div class="upload-area" id="uploadArea">
          <div class="upload-icon">üìÅ</div>
          <div class="upload-text">
            <strong>Click to upload</strong> or drag and drop<br />
            <small>PNG, JPG, GIF up to 10MB</small>
          </div>
        </div>
        <input type="file" id="imageInput" accept="image/*" />
        <img id="previewImage" class="preview-image" alt="Preview" />
      </div>

      <div class="prompt-section">
        <label>Select Image Generation Service</label>
        <select
          id="apiSelect"
          style="
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 20px;
            cursor: pointer;
          "
        >
          <option value="pollinations" selected>
            Pollinations AI (Free - No API Key Needed!)
          </option>
          <option value="together">Together AI (Requires API Key)</option>
          <option value="openrouter">
            OpenRouter (Your Current Key - Text Only)
          </option>
        </select>
      </div>

      <div class="prompt-section">
        <label>Your Prompt</label>
        <textarea
          id="promptInput"
          placeholder="Describe the image you want to generate... Be creative and detailed!"
        ></textarea>
      </div>

      <div class="button-group">
        <button class="generate-btn" id="generateBtn">Generate Image</button>
        <button class="regenerate-btn" id="regenerateBtn">Regenerate</button>
        <button class="download-btn" id="downloadBtn">Download Image</button>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">Creating your masterpiece...</div>
      </div>

      <div class="result-section" id="resultSection">
        <h2 style="margin-bottom: 20px; color: #333">Generated Image</h2>
        <img id="resultImage" class="result-image" alt="Generated Image" />
      </div>
    </div>

    <script>
      const API_KEY =
        "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";

      let uploadedImage = null;
      let generatedImageUrl = null;
      let currentPrompt = "";

      // DOM Elements
      const uploadArea = document.getElementById("uploadArea");
      const imageInput = document.getElementById("imageInput");
      const previewImage = document.getElementById("previewImage");
      const promptInput = document.getElementById("promptInput");
      const apiSelect = document.getElementById("apiSelect");
      const modelSelect = document.getElementById("modelSelect");
      const generateBtn = document.getElementById("generateBtn");
      const regenerateBtn = document.getElementById("regenerateBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const loading = document.getElementById("loading");
      const resultSection = document.getElementById("resultSection");
      const resultImage = document.getElementById("resultImage");
      const errorMessage = document.getElementById("errorMessage");

      // Upload Area Click
      uploadArea.addEventListener("click", () => {
        imageInput.click();
      });

      // Drag and Drop
      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("drag-over");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("drag-over");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("drag-over");
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          handleImageUpload(file);
        }
      });

      // File Input Change
      imageInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          handleImageUpload(file);
        }
      });

      // Handle Image Upload
      function handleImageUpload(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          uploadedImage = e.target.result;
          previewImage.src = uploadedImage;
          previewImage.style.display = "block";
          uploadArea.style.display = "none";
        };
        reader.readAsDataURL(file);
      }

      // Generate Button
      generateBtn.addEventListener("click", generateImage);
      regenerateBtn.addEventListener("click", generateImage);

      // Generate Image Function
      async function generateImage() {
        const prompt = promptInput.value.trim();

        if (!prompt) {
          showError("Please enter a prompt to generate an image.");
          return;
        }

        currentPrompt = prompt;
        hideError();

        // Show loading
        loading.style.display = "block";
        resultSection.style.display = "none";
        generateBtn.disabled = true;
        regenerateBtn.disabled = true;

        const selectedAPI = apiSelect.value;

        try {
          if (selectedAPI === "pollinations") {
            // Using Pollinations AI - Free and no API key needed!
            const encodedPrompt = encodeURIComponent(prompt);
            const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=1024&height=1024&nologo=true`;

            // Pollinations generates the image immediately via URL
            showGeneratedImage(imageUrl);
          } else if (selectedAPI === "together") {
            // Using Together AI for image generation
            const response = await fetch(
              "https://api.together.xyz/v1/images/generations",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${API_KEY}`,
                },
                body: JSON.stringify({
                  model: selectedModel,
                  prompt: prompt,
                  width: 1024,
                  height: 1024,
                  steps: 4,
                  n: 1,
                }),
              }
            );

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(
                errorData.error?.message || `API Error: ${response.status}`
              );
            }

            const data = await response.json();
            console.log("API Response:", data);

            if (data.data && data.data[0] && data.data[0].url) {
              showGeneratedImage(data.data[0].url);
            } else if (data.data && data.data[0] && data.data[0].b64_json) {
              showGeneratedImage(
                "data:image/png;base64," + data.data[0].b64_json
              );
            } else {
              throw new Error("No image in API response");
            }
          } else {
            // Using OpenRouter API
            let messageContent;

            if (uploadedImage) {
              messageContent = [
                {
                  type: "text",
                  text: prompt,
                },
                {
                  type: "image_url",
                  image_url: {
                    url: uploadedImage,
                  },
                },
              ];
            } else {
              messageContent = prompt;
            }

            const response = await fetch(
              "https://openrouter.ai/api/v1/chat/completions",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${API_KEY}`,
                  "HTTP-Referer": window.location.href,
                  "X-Title": "AI Image Generator",
                },
                body: JSON.stringify({
                  model: selectedModel,
                  messages: [
                    {
                      role: "user",
                      content: messageContent,
                    },
                  ],
                }),
              }
            );

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(
                errorData.error?.message || "Failed to generate image"
              );
            }

            const data = await response.json();
            console.log("API Response:", data);

            if (data.choices && data.choices[0] && data.choices[0].message) {
              const message = data.choices[0].message;

              if (message.content) {
                const urlMatch = message.content.match(/https?:\/\/[^\s]+/);
                if (urlMatch) {
                  showGeneratedImage(urlMatch[0]);
                } else if (message.content.startsWith("data:image")) {
                  showGeneratedImage(message.content);
                } else {
                  showError(
                    "No image URL found in response. Response: " +
                      message.content
                  );
                }
              } else {
                throw new Error("No content in API response");
              }
            } else {
              throw new Error("Unexpected response format from API");
            }
          }
        } catch (error) {
          showError(`Error: ${error.message}`);
          console.error("Generation error:", error);
        } finally {
          loading.style.display = "none";
          generateBtn.disabled = false;
          regenerateBtn.disabled = false;
        }
      }

      // Download Button
      downloadBtn.addEventListener("click", () => {
        if (generatedImageUrl) {
          const link = document.createElement("a");
          link.href = generatedImageUrl;
          link.download = `ai-generated-${Date.now()}.png`;
          link.click();
        }
      });

      // Show/Hide Error
      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
      }

      function hideError() {
        errorMessage.style.display = "none";
      }

      // Show Generated Image
      function showGeneratedImage(imageUrl) {
        generatedImageUrl = imageUrl;
        resultImage.src = imageUrl;
        resultSection.style.display = "block";
        regenerateBtn.style.display = "block";
        downloadBtn.style.display = "block";
        generateBtn.style.display = "none";
      }
    </script>
  </body>
</html>
